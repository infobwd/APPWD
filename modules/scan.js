import { copy, toast } from '../ui.js';
import { saveCheckin } from './checkin.js';
let scanner=null; export async function render(){ const box=document.getElementById('qrReader'); const res=document.getElementById('scanResult'); const openBtn=document.getElementById('scanOpen'); const copyBtn=document.getElementById('scanCopy'); box.innerHTML=''; try{ scanner=new Html5Qrcode('qrReader'); await scanner.start({facingMode:'environment'},{fps:10,qrbox:240}, async decodedText=>{ res.textContent=decodedText||''; openBtn.href=decodedText||'#'; toast('ตรวจพบโค้ดแล้ว'); await saveCheckin('qr', { text: decodedText }); }); }catch(e){ box.innerHTML='<div class="p-4 text-sm text-red-600">ไม่สามารถเปิดกล้องได้: '+(e?.message||e)+'</div>'; } copyBtn.onclick=()=> copy(res.textContent||''); }